<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokéTech - Home</title>
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/scroolbar.css">
    <link rel="icon" href="imagens/pokeball.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;800&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <div class="container">
            <img src="imagens/pokeball.png" alt="Poke Ball" class="logo">
            <ul>
                <li class="lista"><a onclick="sobre_nos()">Sobre Nós</a></li>
                <li class="lista"><a onclick="anime()">Anime</a></li>
                <li class="lista"><a onclick="jogo()">Jogo</a></li>
                <li class="lista"><a onclick="grafico()">Gráfico</a></li>
                <li class="lista"><a href="pokedex.html">Pokedex</a></li>
                <li class="lista"><a href="pesquisa.html">Pesquisa</a></li>
            </ul>
        </div>
    </header>

    <main>
        <div class="divisoria">
        </div>
        <div class="sobre_nos">
            <div class="texto">
                <h1>Sobre Nós</h1>
                <p>A PokéTech é um projeto com o objetivo de,</p>
                <p>por meio de artefados e conheciento aprendidos</p>
                <p>em sala de aula, demonstrar para todos a magnitude</p>
                <p>e perfeição que o mundo pokémon possui.</p>
            </div>
        </div>
        <div class="divisoria">
        </div>
        <!-- Fim sobre nós -->
        <div class="anime">
            <h1 style="display: flex; justify-content: center;">Anime</h1>
            <div class="primeiro_texto">
                <p>Os animes pokémon comecaram no ano de 1997</p>
                <p>e logo de cara cativou e atraiu milhares de crianças, adolescente</p>
                <p>e inclusive adultos. A fama dos animes pokémon é tão alta</p>
                <p>que se encontra em 3° lugar dos animes mais vistos do mundo.</p>
                <p>O protagonista desse famoso anime é Ash Ketchum, um garoto</p>
                <p>de 10 anos que está começando sua jornada pelo mundo pokémon</p>
                <p>Ash é um garoto fissurado em pokémon e também ama batalhar ao lado</p>
                <p>de seu companheiro Pikachu e outros pokémons, junto com eles,</p>
                <p>Ash viaja pelo mundo buscando novas aventuras e novos desafios junto</p>
                <p>de seus pokémon e de seus amigos que vai fazendo pelo caminho.</p>
            </div>

            <div class="trailer_anime">
                <iframe class="video_anime" width="500" height="360" src="https://www.youtube.com/embed/dihcy9kIdkQ"
                    title="Trailer oficial da série Jornadas de Mestre Pokémon" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen></iframe>
            </div>
        </div>
        <div class="divisoria">
        </div>
        <!-- Fim anime -->
        <div class="jogo">
            <h1 style="display: flex; justify-content: center;">Jogos</h1>
            <div class="container">
                <div class="segundo_texto">
                    <p>Pokémon, além de ser muito grande na indústria de animes,é ainda maior</p>
                    <p>na indústria de jogos, com mais de 70 títulos, é considerada a segunda maior</p>
                    <p>franquia de jogos, atrás somente da franquia Mario.</p>
                    <p>Os jogos trazem um sentimento muito bom pra quem está jogando, pois</p>
                    <p>entrar no mundo em que se ama e ter seus próprios pokémon chama muito </p>
                    <p>a atenção das pessoas, que cada vez mais jogam e se divertem com o mesmo.</p>
                    <p>Seu jogo mais jogado é Pokémon Red & Blue, que atraiu milhões de fãs,</p>
                    <p>tanto adultos quantos adolescentes e crianças, que jogam o mesmo até hoje</p>
                    <p>mesmo ele tendo sido lançado em 1996, um ano antes do começo do anime da franquia.</p>
                </div>
            </div>
            <div class="trailer_jogo">
                <iframe class="video_jogo" width="500" height="360" src="https://www.youtube.com/embed/tfQj1aQz8d8"
                    title="Pokemon Scarlet and Pokemon Violet - Official Trailer" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen></iframe>
            </div>
        </div>


        <div class="divisoria">
        </div>
        <h1 class="h1" style="display: flex; justify-content: center;">Gráfico</h1>
        <div class="container_grafico">
            <div class="aba_grafico">
                <canvas id="myChartCanvas0" class="grafico"></canvas>
            </div>
        </div>
    </main>




</body>

</html>

<script>
    function sobre_nos() {
        window.scroll({
            top: 680,
            behavior: "smooth"
        })
    }

    function anime() {
        window.scroll({
            top: 1255,
            behavior: "smooth"
        })
    }

    function jogo() {
        window.scroll({
            top: 2055,
            behavior: "smooth"
        })
    }

    function grafico() {
        window.scroll({
            top: 2800,
            behavior: "smooth"
        })
    }
    // Fim da parte de redirecionamento das abas
    obterDadosGrafico(0);
    // let proximaAtualizacao;

    function obterDadosGrafico(idPokemon) {

        // if (proximaAtualizacao != undefined) {
        //     clearTimeout(proximaAtualizacao);
        // }

        fetch(`/pokemonUsuario/ultimas/${idPokemon}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    console.log(resposta)
                    resposta.reverse();
                    plotarGrafico(resposta, idPokemon);

                });

            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta, idPokemon) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'Relatoria de Pesquisa',
                data: [],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                backgroundColor: 'rgb(75, 192, 192)',
                tension: 0.1    
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            console.log(registro)
            labels.push(registro.nomePokemon);
            dados.datasets[0].data.push(registro.Valor);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'bar',
            data: dados,
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`myChartCanvas${idPokemon}`),
            config
        );

        // setTimeout(() => atualizarGrafico(idPokemon, dados, myChart), 2000);
    }


    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas,

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    // function atualizarGrafico(idPokemon, dados, myChart) {



    //     fetch(`/pokemonUsuario/tempo-real/${idPokemon}`, { cache: 'no-store' }).then(function (response) {
    //         if (response.ok) {
    //             response.json().then(function (novoRegistro) {

    //                 // obterdados(idPokemon);
    //                 // alertar(novoRegistro, idPokemon);
    //                 console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
    //                 console.log(`Dados atuais do gráfico:`);
    //                 console.log(dados);

    //                 // let avisoCaptura = document.getElementById(`avisoCaptura${idPokemon}`)
    //                 // avisoCaptura.innerHTML = ""


    //                 if (novoRegistro[0].momento_grafico == dados.labels[dados.labels.length - 1]) {
    //                     console.log("---------------------------------------------------------------")
    //                     console.log("Como não há dados novos para captura, o gráfico não atualizará.")
    //                     avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
    //                     console.log("Horário do novo dado capturado:")
    //                     console.log(novoRegistro[0].momento_grafico)
    //                     console.log("Horário do último dado capturado:")
    //                     console.log(dados.labels[dados.labels.length - 1])
    //                     console.log("---------------------------------------------------------------")
    //                 } else {
    //                     // tirando e colocando valores no gráfico
    //                     // dados.labels.shift(); // apagar o primeiro
    //                     // dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

    //                     dados.datasets[0].data.shift();  // apagar o primeiro de umidade
    //                     dados.datasets[0].data.push(novoRegistro[0].Votos); // incluir uma nova medida de umidade

    //                     // dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
    //                     // dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

    //                     myChart.update();
    //                 }

    //                 // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
    //                 proximaAtualizacao = setTimeout(() => atualizarGrafico(idPokemon, dados, myChart), 2000);
    //             });
    //         } else {
    //             console.error('Nenhum dado encontrado ou erro na API');
    //             // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
    //             proximaAtualizacao = setTimeout(() => atualizarGrafico(idPokemon, dados, myChart), 2000);
    //         }
    //     })
    //         .catch(function (error) {
    //             console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    //         });

    // }

</script>